import{_ as N}from"./Dropdown-6c65a629.js";import{a as u,c as i,l as B,d as C,r as d,q as S,b as g,w as p,p as h,u as v,n as _,t as D,F,e as t,i as y}from"./app-af608028.js";const k={__name:"DropdownButton",props:{action:Function},setup(f){const n=f,s=()=>{n.action()};return(e,l)=>(u(),i("button",{class:"block w-full px-4 py-2 text-left text-sm leading-5 text-gray-700 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 transition duration-150 ease-in-out",onClick:s},[B(e.$slots,"default")]))}},V=t("button",{class:"flex w-full sm:w-auto items-center px-4 py-2 bg-blue-500 hover:bg-blue-600 font-bold focus:outline-none text-white rounded"},[t("svg",{class:"text-white h-6 w-6",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M12 5v14M5 12l7 7 7-7"})]),h(" Export Products ")],-1),A={key:0,class:"flex items-center"},M=t("div",{class:"dots-loading flex items-center"},[t("div"),t("div"),t("div")],-1),$=t("p",{class:"ml-2 inline-block align-middle"},"Generating",-1),j=[M,$],q=["href"],T={key:2,class:"text-red-500 flex items-center"},O={__name:"ProductsExport",props:{products:{type:Object,required:!0}},setup(f){const{products:n}=f,s=C.useToast();let e=d(!1),l=d(null),c=null,m=d(!1);const a=d(""),w=async(o=1,r=n.total)=>{if(a.value="",e.value){s.info("Export already in progress");return}l.value=null;try{const x=await y.get(route("api.admin.products.export",{from:o,to:r}));b(x.data.filename)}catch(x){a.value=x.response.data.message,e.value=!1,s.error("Something went wrong"),clearInterval(c)}},b=o=>{e.value=!0,c=setInterval(()=>E(o),3e3)},E=async o=>{try{m.value=!0;const r=await y.get(route("api.admin.products.export.check",{fileName:o}));r.status===200&&r.data.status==="READY"&&(e.value=!1,l.value=route("api.admin.products.export.download",{fileName:o}),clearInterval(c),localStorage.removeItem("exportFilename"),s.success("Export ready"),m.value=!1)}catch(r){a.value=r.response.data.message,s.error("Something went wrong"),e.value=!1,clearInterval(c),m.value=!1}},P=()=>w(n.from,n.to),I=()=>w();return S(()=>{clearInterval(c)}),(o,r)=>(u(),i(F,null,[g(N,null,{trigger:p(()=>[V]),content:p(()=>[g(k,{action:P},{default:p(()=>[h(" Export current page ")]),_:1}),g(k,{action:I},{default:p(()=>[h(" Export all products ")]),_:1})]),_:1}),v(e)?(u(),i("div",A,j)):_("",!0),v(l)&&!a.value?(u(),i("a",{key:1,href:v(l),class:"flex items-center underline"}," Download Export ",8,q)):_("",!0),a.value?(u(),i("p",T,D(a.value),1)):_("",!0)],64))}};export{O as default};
